<!-- pages/rewards/rewards.wxml - 积分奖励页面模板 -->
<view class="container">
  <!-- 用户积分头部 -->
  <view class="points-header">
    <view class="user-avatar">
      <image wx:if="{{userInfo.avatar}}" src="{{userInfo.avatar}}" class="avatar-image"/>
      <text wx:else class="avatar-placeholder">{{userInfo.nickname ? userInfo.nickname.charAt(0) : 'U'}}</text>
    </view>
    <view class="points-info">
      <text class="user-name">{{userInfo.nickname || '用户'}}</text>
      <view class="points-display">
        <text class="points-number">{{userInfo.points || 0}}</text>
        <text class="points-label">积分</text>
      </view>
      <text class="user-level" style="color: {{getPointsLevel(userInfo.points).color}}">
        {{getPointsLevel(userInfo.points).name}}
      </text>
    </view>
  </view>

  <!-- 标签切换 -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 'rewards' ? 'active' : ''}}"
      data-tab="rewards"
      bindtap="switchTab"
    >
      <text class="tab-text">积分商城</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'records' ? 'active' : ''}}"
      data-tab="records"
      bindtap="switchTab"
    >
      <text class="tab-text">积分记录</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 积分商城 -->
  <view wx:elif="{{currentTab === 'rewards'}}" class="rewards-content">
    <view wx:if="{{rewards.length > 0}}" class="rewards-grid">
      <view 
        wx:for="{{rewards}}" 
        wx:key="id"
        class="reward-card"
        data-reward-id="{{item.id}}"
        data-reward-name="{{item.name}}"
        data-points="{{item.points}}"
        bindtap="exchangeReward"
      >
        <view class="reward-icon">{{getRewardIcon(item.type)}}</view>
        <view class="reward-info">
          <text class="reward-name">{{item.name}}</text>
          <text class="reward-desc">{{item.description}}</text>
        </view>
        <view class="reward-price">
          <text class="price-number">{{item.points}}</text>
          <text class="price-label">积分</text>
        </view>
        <view class="reward-status">
          <text wx:if="{{userInfo.points >= item.points}}" class="status-available">可兑换</text>
          <text wx:else class="status-unavailable">积分不足</text>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">🎁</view>
      <text class="empty-text">暂无可兑换奖励</text>
      <text class="empty-desc">继续打卡获得更多积分吧！</text>
    </view>
  </view>

  <!-- 积分记录 -->
  <view wx:elif="{{currentTab === 'records'}}" class="records-content">
    <view wx:if="{{pointRecords.length > 0}}" class="records-list">
      <view wx:for="{{pointRecords}}" wx:key="id" class="record-item">
        <view class="record-icon">{{getRecordIcon(item.type, item.reason)}}</view>
        <view class="record-info">
          <text class="record-reason">{{item.reason}}</text>
          <text class="record-time">{{formatTime(item.created_at)}}</text>
        </view>
        <view class="record-points">
          <text 
            class="points-change {{item.type === 'earn' ? 'earn' : 'spend'}}"
          >
            {{formatPoints(item.points, item.type)}}
          </text>
        </view>
      </view>
      
      <!-- 加载更多提示 -->
      <view wx:if="{{hasMore}}" class="load-more">
        <text class="load-more-text">上拉加载更多</text>
      </view>
      <view wx:else class="no-more">
        <text class="no-more-text">没有更多记录了</text>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">📊</view>
      <text class="empty-text">暂无积分记录</text>
      <text class="empty-desc">开始打卡获得积分吧！</text>
    </view>
  </view>

  <!-- 积分规则说明 -->
  <view class="rules-section">
    <view class="rules-header" bindtap="toggleRules">
      <text class="rules-title">积分获得规则</text>
      <text class="rules-arrow">ℹ️</text>
    </view>
    <view class="rules-content">
      <view class="rule-item">
        <text class="rule-icon">📅</text>
        <text class="rule-text">每日打卡：+10积分</text>
      </view>
      <view class="rule-item">
        <text class="rule-icon">🔥</text>
        <text class="rule-text">连续7天：+50积分奖励</text>
      </view>
      <view class="rule-item">
        <text class="rule-icon">💪</text>
        <text class="rule-text">连续30天：+200积分奖励</text>
      </view>
      <view class="rule-item">
        <text class="rule-icon">⭐</text>
        <text class="rule-text">月度100%完成：+300积分奖励</text>
      </view>
    </view>
  </view>

  <!-- 分享按钮 -->
  <view class="share-section">
    <button class="btn btn-outline btn-large" open-type="share">
      分享我的积分
    </button>
  </view>
</view>
