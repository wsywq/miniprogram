<!-- pages/rewards/rewards.wxml - ç§¯åˆ†å¥–åŠ±é¡µé¢æ¨¡æ¿ -->
<view class="container">
  <!-- ç”¨æˆ·ç§¯åˆ†å¤´éƒ¨ -->
  <view class="points-header">
    <view class="user-avatar">
      <image wx:if="{{userInfo.avatar}}" src="{{userInfo.avatar}}" class="avatar-image"/>
      <text wx:else class="avatar-placeholder">{{userInfo.nickname ? userInfo.nickname.charAt(0) : 'U'}}</text>
    </view>
    <view class="points-info">
      <text class="user-name">{{userInfo.nickname || 'ç”¨æˆ·'}}</text>
      <view class="points-display">
        <text class="points-number">{{userInfo.points || 0}}</text>
        <text class="points-label">ç§¯åˆ†</text>
      </view>
      <text class="user-level" style="color: {{getPointsLevel(userInfo.points).color}}">
        {{getPointsLevel(userInfo.points).name}}
      </text>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 'rewards' ? 'active' : ''}}"
      data-tab="rewards"
      bindtap="switchTab"
    >
      <text class="tab-text">ç§¯åˆ†å•†åŸ</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'records' ? 'active' : ''}}"
      data-tab="records"
      bindtap="switchTab"
    >
      <text class="tab-text">ç§¯åˆ†è®°å½•</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç§¯åˆ†å•†åŸ -->
  <view wx:elif="{{currentTab === 'rewards'}}" class="rewards-content">
    <view wx:if="{{rewards.length > 0}}" class="rewards-grid">
      <view 
        wx:for="{{rewards}}" 
        wx:key="id"
        class="reward-card"
        data-reward-id="{{item.id}}"
        data-reward-name="{{item.name}}"
        data-points="{{item.points}}"
        bindtap="exchangeReward"
      >
        <view class="reward-icon">{{getRewardIcon(item.type)}}</view>
        <view class="reward-info">
          <text class="reward-name">{{item.name}}</text>
          <text class="reward-desc">{{item.description}}</text>
        </view>
        <view class="reward-price">
          <text class="price-number">{{item.points}}</text>
          <text class="price-label">ç§¯åˆ†</text>
        </view>
        <view class="reward-status">
          <text wx:if="{{userInfo.points >= item.points}}" class="status-available">å¯å…‘æ¢</text>
          <text wx:else class="status-unavailable">ç§¯åˆ†ä¸è¶³</text>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ</view>
      <text class="empty-text">æš‚æ— å¯å…‘æ¢å¥–åŠ±</text>
      <text class="empty-desc">ç»§ç»­æ‰“å¡è·å¾—æ›´å¤šç§¯åˆ†å§ï¼</text>
    </view>
  </view>

  <!-- ç§¯åˆ†è®°å½• -->
  <view wx:elif="{{currentTab === 'records'}}" class="records-content">
    <view wx:if="{{pointRecords.length > 0}}" class="records-list">
      <view wx:for="{{pointRecords}}" wx:key="id" class="record-item">
        <view class="record-icon">{{getRecordIcon(item.type, item.reason)}}</view>
        <view class="record-info">
          <text class="record-reason">{{item.reason}}</text>
          <text class="record-time">{{formatTime(item.created_at)}}</text>
        </view>
        <view class="record-points">
          <text 
            class="points-change {{item.type === 'earn' ? 'earn' : 'spend'}}"
          >
            {{formatPoints(item.points, item.type)}}
          </text>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{hasMore}}" class="load-more">
        <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
      <view wx:else class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šè®°å½•äº†</text>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“Š</view>
      <text class="empty-text">æš‚æ— ç§¯åˆ†è®°å½•</text>
      <text class="empty-desc">å¼€å§‹æ‰“å¡è·å¾—ç§¯åˆ†å§ï¼</text>
    </view>
  </view>

  <!-- ç§¯åˆ†è§„åˆ™è¯´æ˜ -->
  <view class="rules-section">
    <view class="rules-header" bindtap="toggleRules">
      <text class="rules-title">ç§¯åˆ†è·å¾—è§„åˆ™</text>
      <text class="rules-arrow">â„¹ï¸</text>
    </view>
    <view class="rules-content">
      <view class="rule-item">
        <text class="rule-icon">ğŸ“…</text>
        <text class="rule-text">æ¯æ—¥æ‰“å¡ï¼š+10ç§¯åˆ†</text>
      </view>
      <view class="rule-item">
        <text class="rule-icon">ğŸ”¥</text>
        <text class="rule-text">è¿ç»­7å¤©ï¼š+50ç§¯åˆ†å¥–åŠ±</text>
      </view>
      <view class="rule-item">
        <text class="rule-icon">ğŸ’ª</text>
        <text class="rule-text">è¿ç»­30å¤©ï¼š+200ç§¯åˆ†å¥–åŠ±</text>
      </view>
      <view class="rule-item">
        <text class="rule-icon">â­</text>
        <text class="rule-text">æœˆåº¦100%å®Œæˆï¼š+300ç§¯åˆ†å¥–åŠ±</text>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«æŒ‰é’® -->
  <view class="share-section">
    <button class="btn btn-outline btn-large" open-type="share">
      åˆ†äº«æˆ‘çš„ç§¯åˆ†
    </button>
  </view>
</view>
