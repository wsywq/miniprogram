<!-- pages/statistics/statistics.wxml - ç»Ÿè®¡åˆ†æé¡µé¢æ¨¡æ¿ -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading"></view>
    <text class="loading-text">åŠ è½½ç»Ÿè®¡æ•°æ®ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else>
    <!-- æ—¶é—´æ®µé€‰æ‹© -->
    <view class="period-selector">
      <picker 
        mode="selector" 
        range="{{periods}}" 
        range-key="label"
        value="{{periods.findIndex(item => item.value === period)}}"
        bindchange="onPeriodChange"
      >
        <view class="period-display">
          <text class="period-text">{{getPeriodTitle()}}</text>
          <view class="selector-arrow">â–¼</view>
        </view>
      </picker>
    </view>

    <!-- æ€»ä½“ç»Ÿè®¡å¡ç‰‡ -->
    <view class="overview-stats">
      <view class="stat-row">
        <view class="stat-card primary">
          <text class="stat-number">{{stats.completionRate}}%</text>
          <text class="stat-label">å®Œæˆç‡</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{stats.streakDays}}</text>
          <text class="stat-label">è¿ç»­å¤©æ•°</text>
        </view>
      </view>
      
      <view class="stat-row">
        <view class="stat-card">
          <text class="stat-number">{{stats.totalCheckins}}</text>
          <text class="stat-label">æ€»æ‰“å¡æ•°</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{stats.totalPoints}}</text>
          <text class="stat-label">è·å¾—ç§¯åˆ†</text>
        </view>
      </view>
    </view>

    <!-- è¶‹åŠ¿å›¾è¡¨ -->
    <view class="chart-section card">
      <view class="section-header">
        <text class="section-title">æ‰“å¡è¶‹åŠ¿</text>
      </view>
      
      <view class="trend-chart">
        <view class="chart-container">
          <view wx:for="{{trendData}}" wx:key="date" class="chart-bar">
            <view 
              class="bar" 
              style="height: {{item.count * 20}}px; background: {{item.count > 0 ? '#4CAF50' : '#e0e0e0'}}"
            ></view>
            <text class="bar-label">{{item.label}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¹ æƒ¯æ’è¡Œ -->
    <view class="habits-ranking card">
      <view class="section-header">
        <text class="section-title">ä¹ æƒ¯æ’è¡Œ</text>
        <text class="section-desc">æŒ‰å®Œæˆç‡æ’åº</text>
      </view>
      
      <view wx:if="{{habitStats.length > 0}}" class="ranking-list">
        <view 
          wx:for="{{habitStats}}" 
          wx:key="id"
          class="ranking-item"
          data-habit-id="{{item.id}}"
          bindtap="goToHabitDetail"
        >
          <view class="ranking-info">
            <view class="habit-icon">{{item.icon}}</view>
            <view class="habit-details">
              <text class="habit-name">{{item.name}}</text>
              <text class="habit-progress">{{item.checkinDays}}/{{item.totalDays}} å¤©</text>
            </view>
          </view>
          
          <view class="ranking-stats">
            <text 
              class="completion-rate"
              style="color: {{getCompletionColor(item.completionRate)}}"
            >
              {{item.completionRate}}%
            </text>
            <text class="completion-level">{{getCompletionLevel(item.completionRate)}}</text>
          </view>
        </view>
      </view>
      
      <view wx:else class="empty-state">
        <text class="empty-text">æš‚æ— ä¹ æƒ¯æ•°æ®</text>
      </view>
    </view>

    <!-- åˆ†ç±»ç»Ÿè®¡ -->
    <view class="category-stats card">
      <view class="section-header">
        <text class="section-title">åˆ†ç±»ç»Ÿè®¡</text>
      </view>
      
      <view wx:if="{{categoryStats.length > 0}}" class="category-list">
        <view wx:for="{{categoryStats}}" wx:key="category" class="category-item">
          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <text class="category-count">{{item.count}} ä¸ªä¹ æƒ¯</text>
          </view>
          
          <view class="category-progress">
            <view class="progress-bar">
              <view 
                class="progress-fill" 
                style="width: {{item.completionRate}}%; background: {{getCompletionColor(item.completionRate)}}"
              ></view>
            </view>
            <text class="progress-text">{{item.completionRate}}%</text>
          </view>
        </view>
      </view>
      
      <view wx:else class="empty-state">
        <text class="empty-text">æš‚æ— åˆ†ç±»æ•°æ®</text>
      </view>
    </view>

    <!-- æˆå°±å±•ç¤º -->
    <view class="achievements card">
      <view class="section-header">
        <text class="section-title">æˆ‘çš„æˆå°±</text>
      </view>
      
      <view class="achievement-grid">
        <view class="achievement-item {{stats.streakDays >= 7 ? 'unlocked' : 'locked'}}">
          <text class="achievement-icon">ğŸ”¥</text>
          <text class="achievement-name">è¿ç»­ä¸€å‘¨</text>
          <text class="achievement-desc">è¿ç»­æ‰“å¡7å¤©</text>
        </view>
        
        <view class="achievement-item {{stats.streakDays >= 30 ? 'unlocked' : 'locked'}}">
          <text class="achievement-icon">ğŸ’ª</text>
          <text class="achievement-name">åšæŒä¸€æœˆ</text>
          <text class="achievement-desc">è¿ç»­æ‰“å¡30å¤©</text>
        </view>
        
        <view class="achievement-item {{stats.completionRate >= 80 ? 'unlocked' : 'locked'}}">
          <text class="achievement-icon">â­</text>
          <text class="achievement-name">ä¼˜ç§€è¡¨ç°</text>
          <text class="achievement-desc">å®Œæˆç‡è¾¾åˆ°80%</text>
        </view>
        
        <view class="achievement-item {{stats.totalPoints >= 1000 ? 'unlocked' : 'locked'}}">
          <text class="achievement-icon">ğŸ’</text>
          <text class="achievement-name">ç§¯åˆ†è¾¾äºº</text>
          <text class="achievement-desc">ç´¯è®¡1000ç§¯åˆ†</text>
        </view>
      </view>
    </view>

    <!-- åˆ†äº«æŒ‰é’® -->
    <view class="share-section">
      <button class="btn btn-outline btn-large" open-type="share">
        åˆ†äº«æˆ‘çš„ç»Ÿè®¡
      </button>
    </view>
  </view>
</view>
