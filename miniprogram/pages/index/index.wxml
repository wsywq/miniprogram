<!-- pages/index/index.wxml - é¦–é¡µæ¨¡æ¿ -->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
  <view class="header-section">
    <view class="user-greeting">
      <text class="greeting-text">{{greeting}}ï¼Œ{{userInfo.nickname || 'ç”¨æˆ·'}}</text>
      <text class="date-text">{{todayDate}}</text>
    </view>
    <view class="user-points">
      <text class="points-label">ç§¯åˆ†</text>
      <text class="points-value">{{userInfo.points || 0}}</text>
    </view>
  </view>

  <!-- ä»Šæ—¥æ¦‚è§ˆ -->
  <view class="today-overview card">
    <view class="card-title">ä»Šæ—¥æ¦‚è§ˆ</view>
    <view class="overview-stats">
      <view class="stat-item">
        <text class="stat-number">{{habits.length}}</text>
        <text class="stat-label">æ€»ä¹ æƒ¯</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{Object.keys(todayCheckins).length}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{habits.length - Object.keys(todayCheckins).length}}</text>
        <text class="stat-label">å¾…å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- ä¹ æƒ¯åˆ—è¡¨ -->
  <view class="habits-section">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„ä¹ æƒ¯</text>
      <view class="add-habit-btn" bindtap="goToCreateHabit">
        <text class="add-icon">+</text>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ä¹ æƒ¯åˆ—è¡¨ -->
    <view wx:elif="{{habits.length > 0}}" class="habits-list">
      <view 
        wx:for="{{habits}}" 
        wx:key="id" 
        class="habit-card {{getHabitStatus(item.id) === 'completed' ? 'completed' : ''}}"
        data-habit-id="{{item.id}}"
        data-habit-name="{{item.name}}"
        bindtap="goToCheckin"
        bindlongpress="onHabitLongPress"
      >
        <view class="habit-info">
          <view class="habit-icon">{{item.icon || 'ğŸ“'}}</view>
          <view class="habit-details">
            <text class="habit-name">{{item.name}}</text>
            <text class="habit-streak">{{formatStreakText(getStreakDays(item))}}</text>
          </view>
        </view>
        
        <view class="habit-actions">
          <view 
            wx:if="{{getHabitStatus(item.id) === 'pending'}}"
            class="checkin-btn"
            data-habit-id="{{item.id}}"
            bindtap="quickCheckin"
            catchtap="true"
          >
            <text class="checkin-text">æ‰“å¡</text>
          </view>
          <view wx:else class="completed-badge">
            <text class="completed-text">âœ“</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-state-icon">ğŸ“</view>
      <text class="empty-state-text">è¿˜æ²¡æœ‰ä¹ æƒ¯</text>
      <text class="empty-state-desc">ç‚¹å‡»å³ä¸Šè§’ + å·åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªä¹ æƒ¯</text>
      <view class="btn btn-primary mt-16" bindtap="goToCreateHabit">
        åˆ›å»ºä¹ æƒ¯
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="goToCreateHabit">
      <view class="action-icon">â•</view>
      <text class="action-text">æ·»åŠ ä¹ æƒ¯</text>
    </view>
    <navigator url="/pages/statistics/statistics" class="action-item">
      <view class="action-icon">ğŸ“Š</view>
      <text class="action-text">æŸ¥çœ‹ç»Ÿè®¡</text>
    </navigator>
    <navigator url="/pages/rewards/rewards" class="action-item">
      <view class="action-icon">ğŸ</view>
      <text class="action-text">ç§¯åˆ†å•†åŸ</text>
    </navigator>
  </view>
</view>
